// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“˜ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù‘Ù† - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 
// ğŸ¯ Ø§Ù„Ù‡Ø¯Ù: Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø°ÙƒÙŠØ© Ù…Ø¹ Ø£Ø¯Ø§Ø¡ Ø¹Ø§Ù„ÙŠ
// âœ… ÙŠØ¯Ø¹Ù…: Ø§Ù„Ø¥Ø¶Ø§ÙØ©ØŒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙÙˆØ±ÙŠ
// âš¡ Ø§Ù„Ø£Ø¯Ø§Ø¡: Ù…Ø­Ø³Ù‘Ù† Ø¨Ø¹Ù…Ù„ÙŠØ§Øª Ø¬Ù…Ø§Ø¹ÙŠØ© ÙˆØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
// ğŸ”’ Ø¢Ù…Ù†: ÙŠØ­Ø°Ù ÙÙ‚Ø· Ù…Ø§ Ù‡Ùˆ Ù…Ø­Ø°ÙˆÙ Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš™ï¸ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CONFIG = {
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ“‚ Ø±ÙˆØ§Ø¨Ø· Ù…Ù„ÙØ§Øª Ø§Ù„Ù€Source Sheets
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  SOURCE_SHEET_IDS: [
    '1vXjmstoCeUI8AUBXDUrScHGtYGpfsXA9unS18fIXmRQ',
    '1RLwxZKlgUSexgWfeYeCnRUPmug6lwuLgc4dhiTi9ULQ'
  ],
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ“‹ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  SOURCE_SHEET_NAME: 'sheet1',
  MASTER_SHEET_NAME: 'sheet1',
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”‘ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ID_COLUMN_INDEX: 24,             // Ø±Ù‚Ù… Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù€ID ÙÙŠ Master (Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±)
  SOURCE_NAME_COLUMN_INDEX: 1,     // Ø¹Ù…ÙˆØ¯ Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø± (Ø§Ù„Ø¹Ù…ÙˆØ¯ A)
  ID_PREFIX: 'ROW_',
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ“Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  HAS_HEADER_ROW: true,
  START_ROW: 2,
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // â±ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  AUTO_SYNC_INTERVAL_HOURS: 1,
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  BATCH_SIZE: 500,
  ENABLE_DETAILED_LOGS: true
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“‹ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…Ù„Ù
 */
function onOpen() {
  try {
    const ui = SpreadsheetApp.getUi();
    
    ui.createMenu('ğŸ”„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ©')
      .addItem('â–¶ï¸ ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±', 'syncAllSources')
      .addSeparator()
      .addItem('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ IDs Ù„Ù„ØµÙÙˆÙ', 'regenerateAllIds')
      .addItem('ğŸ“Š Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©', 'showSyncStatistics')
      .addSeparator()
      .addSubMenu(ui.createMenu('âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ')
        .addItem('âœ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', 'enableAutoSync')
        .addItem('âŒ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©', 'disableAutoSync')
        .addItem('ğŸ“‹ Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'showTriggerStatus'))
      .addSeparator()
      .addItem('ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©', 'setupMasterHeaders')
      .addItem('ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', 'showUserGuide')
      .addToUi();
    
    log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ©');
  } catch (error) {
    console.log('âš ï¸ onOpen ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙ… ØªØ´ØºÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù…Ù„Ù');
  }
}

/**
 * Ø¯Ø§Ù„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ
 */
function testSetup() {
  console.log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯...');
  
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    console.log('âœ… ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ù„Ù: ' + ss.getName());
    
    const masterSheet = ss.getSheetByName(CONFIG.MASTER_SHEET_NAME);
    if (masterSheet) {
      console.log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Master Sheet: ' + CONFIG.MASTER_SHEET_NAME);
    } else {
      console.log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Master Sheet: ' + CONFIG.MASTER_SHEET_NAME);
    }
    
    console.log('\nğŸ“‚ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ØµØ§Ø¯Ø±...');
    CONFIG.SOURCE_SHEET_IDS.forEach((id, index) => {
      try {
        const sourceSpreadsheet = SpreadsheetApp.openById(id);
        console.log(`âœ… Ø§Ù„Ù…ØµØ¯Ø± ${index + 1}: ${sourceSpreadsheet.getName()}`);
      } catch (error) {
        console.log(`âŒ Ø§Ù„Ù…ØµØ¯Ø± ${index + 1}: Ø®Ø·Ø£ - ${error.message}`);
      }
    });
    
    console.log('\nâœ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ø§Ù‡Ø²! Ø£ØºÙ„Ù‚ Ø§Ù„Ù…Ù„Ù ÙˆØ£Ø¹Ø¯ ÙØªØ­Ù‡ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.');
    
  } catch (error) {
    console.log('âŒ Ø®Ø·Ø£: ' + error.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸš€ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function syncAllSources() {
  const startTime = new Date();
  log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  log('ğŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø©...');
  log('â° Ø§Ù„ØªÙˆÙ‚ÙŠØª: ' + Utilities.formatDate(startTime, Session.getScriptTimeZone(), 'yyyy-MM-dd HH:mm:ss'));
  log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  
  try {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 1ï¸âƒ£ ØªØ­Ø¶ÙŠØ± Ù…Ù„Ù Ø§Ù„Ù€Master
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const masterSS = SpreadsheetApp.getActiveSpreadsheet();
    const masterSheet = masterSS.getSheetByName(CONFIG.MASTER_SHEET_NAME);
    
    if (!masterSheet) {
      throw new Error(`âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù€Master: "${CONFIG.MASTER_SHEET_NAME}"`);
    }
    
    log(`ğŸ“Š Ù…Ù„Ù Ø§Ù„Ù€Master: ${masterSS.getName()}`);
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
    ensureMasterHeaders(masterSheet);
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 2ï¸âƒ£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù€Master
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    log('ğŸ“¥ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù† Master...');
    const masterData = loadSheetData(masterSheet);
    const masterMap = createMasterMap(masterData.rows, masterData.startRow);
    
    log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${masterData.rows.length} ØµÙ Ù…Ù† Master`);
    log(`ğŸ”‘ Ø¹Ø¯Ø¯ IDs Ø§Ù„ÙØ±ÙŠØ¯Ø©: ${masterMap.size}`);
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 3ï¸âƒ£ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const stats = {
      sourcesProcessed: 0,
      rowsAdded: 0,
      rowsUpdated: 0,
      rowsDeleted: 0,
      rowsSkipped: 0,
      idsGenerated: 0,
      errors: []
    };
    
    // ØªØªØ¨Ø¹ IDs Ø§Ù„Ù†Ø´Ø·Ø© ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ø±
    const activeSourceData = new Map();
    let globalSourceOrder = 0;
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 4ï¸âƒ£ Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„ Ù…Ù„Ù Source ÙˆØ¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    log('\nğŸ“‚ Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØµØ§Ø¯Ø±...');
    log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
    
    for (let i = 0; i < CONFIG.SOURCE_SHEET_IDS.length; i++) {
      const sourceId = CONFIG.SOURCE_SHEET_IDS[i];
      const sourceNum = i + 1;
      
      log(`\n[${sourceNum}/${CONFIG.SOURCE_SHEET_IDS.length}] ğŸ” Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØµØ¯Ø±...`);
      
      try {
        const sourceSpreadsheet = SpreadsheetApp.openById(sourceId);
        const sourceSheet = sourceSpreadsheet.getSheetByName(CONFIG.SOURCE_SHEET_NAME);
        
        if (!sourceSheet) {
          const errorMsg = `âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ "${CONFIG.SOURCE_SHEET_NAME}" ÙÙŠ Ø§Ù„Ù…Ù„Ù: ${sourceSpreadsheet.getName()}`;
          log(errorMsg);
          stats.errors.push(errorMsg);
          continue;
        }
        
        const sourceName = sourceSpreadsheet.getName();
        log(`   ğŸ“„ Ø§Ù„Ù…Ù„Ù: ${sourceName}`);
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµØ¯Ø±
        const sourceData = loadSheetData(sourceSheet);
        log(`   ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ: ${sourceData.rows.length}`);
        
        if (sourceData.rows.length === 0) {
          log(`   âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ¯Ø±`);
          stats.sourcesProcessed++;
          continue;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ IDs Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const idsCreated = ensureIdsInSourceBatch(sourceSheet, sourceData);
        stats.idsGenerated += idsCreated;
        
        if (idsCreated > 0) {
          log(`   ğŸ”‘ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${idsCreated} ID Ø¬Ø¯ÙŠØ¯`);
        }
        
        // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ¯Ø± (Ù…Ø¹ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©)
        let skippedInSource = 0;
        sourceData.rows.forEach((row, localIndex) => {
          // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙ Ù„ÙŠØ³ ÙØ§Ø±ØºÙ‹Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
          if (isRowEmpty(row)) {
            skippedInSource++;
            return;
          }
          
          const idColIndex = CONFIG.ID_COLUMN_INDEX - 2;
          const id = String(row[idColIndex]).trim();
          
          if (id && id !== '') {
            // Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø± ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµÙ
            const rowWithSource = [sourceName, ...row];
            
            activeSourceData.set(id, {
              sourceName: sourceName,
              rowData: rowWithSource,
              sourceOrder: globalSourceOrder++,
              localOrder: localIndex
            });
          }
        });
        
        if (skippedInSource > 0) {
          log(`   â­ï¸ ØªÙ… ØªØ¬Ø§Ù‡Ù„ ${skippedInSource} ØµÙ ÙØ§Ø±Øº`);
          stats.rowsSkipped += skippedInSource;
        }
        
        stats.sourcesProcessed++;
        log(`   âœ… ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØµØ¯Ø± Ø¨Ù†Ø¬Ø§Ø­`);
        
      } catch (error) {
        const errorMsg = `âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØµØ¯Ø± [${sourceNum}]: ${error.message}`;
        log(errorMsg);
        stats.errors.push(errorMsg);
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 5ï¸âƒ£ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Master
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    log('\nğŸ”„ Ø¨Ø¯Ø¡ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Master...');
    const syncResults = syncDataToMaster(masterSheet, masterMap, activeSourceData);
    
    stats.rowsAdded = syncResults.added;
    stats.rowsUpdated = syncResults.updated;
    
    log(`âœ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${stats.rowsAdded} | Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${stats.rowsUpdated}`);
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 6ï¸âƒ£ Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙÙˆØ±ÙŠ Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    log('\nğŸ—‘ï¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© (Ø­Ø°Ù ÙÙˆØ±ÙŠ)...');
    stats.rowsDeleted = deleteRemovedRows(masterSheet, masterMap, activeSourceData);
    
    if (stats.rowsDeleted > 0) {
      log(`âœ… ØªÙ… Ø­Ø°Ù ${stats.rowsDeleted} ØµÙ Ù…Ù† Master`);
    } else {
      log('âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙˆÙ Ù„Ù„Ø­Ø°Ù');
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 7ï¸âƒ£ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    SpreadsheetApp.flush();
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 8ï¸âƒ£ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const duration = ((new Date() - startTime) / 1000).toFixed(2);
    
    log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    log('âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    log(`ğŸ“‚ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${stats.sourcesProcessed}/${CONFIG.SOURCE_SHEET_IDS.length}`);
    log(`â• ØµÙÙˆÙ Ù…Ø¶Ø§ÙØ©: ${stats.rowsAdded}`);
    log(`âœï¸ ØµÙÙˆÙ Ù…Ø­Ø¯Ù‘Ø«Ø©: ${stats.rowsUpdated}`);
    log(`ğŸ—‘ï¸ ØµÙÙˆÙ Ù…Ø­Ø°ÙˆÙØ©: ${stats.rowsDeleted}`);
    log(`â­ï¸ ØµÙÙˆÙ Ù…ØªØ¬Ø§Ù‡Ù„Ø© (ÙØ§Ø±ØºØ©): ${stats.rowsSkipped}`);
    log(`ğŸ”‘ IDs Ù…Ù†Ø´Ø£Ø©: ${stats.idsGenerated}`);
    log(`â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: ${duration} Ø«Ø§Ù†ÙŠØ©`);
    
    if (stats.errors.length > 0) {
      log(`âš ï¸ Ø£Ø®Ø·Ø§Ø¡: ${stats.errors.length}`);
      stats.errors.forEach(err => log(`   - ${err}`));
    }
    
    log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    
    showSyncCompletionMessage(stats, duration);
    
  } catch (error) {
    log('âŒ Ø®Ø·Ø£ ÙØ§Ø¯Ø­ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ' + error.message);
    log('ğŸ“ Stack: ' + error.stack);
    
    SpreadsheetApp.getUi().alert(
      'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©',
      `Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:\n\n${error.message}\n\nØ±Ø§Ø¬Ø¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù„Ù„ØªÙØ§ØµÙŠÙ„.`,
      SpreadsheetApp.getUi().ButtonSet.OK
    );
    
    throw error;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ› ï¸ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙ ÙØ§Ø±Øº Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
 */
function isRowEmpty(row) {
  if (!row || row.length === 0) return true;
  
  return row.every(cell => {
    if (cell === null || cell === undefined || cell === '') return true;
    if (typeof cell === 'string' && cell.trim() === '') return true;
    return false;
  });
}

/**
 * Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Master
 */
function ensureMasterHeaders(sheet) {
  if (!CONFIG.HAS_HEADER_ROW) return;
  
  const firstRow = sheet.getRange(1, 1, 1, sheet.getLastColumn() || 10).getValues()[0];
  
  if (!firstRow[0] || firstRow[0] === '') {
    log('âš ï¸ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯...');
    setupMasterHeaders();
  }
}

/**
 * Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Master
 */
function setupMasterHeaders() {
  const masterSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(CONFIG.MASTER_SHEET_NAME);
  
  if (!masterSheet) {
    SpreadsheetApp.getUi().alert('âŒ Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ¨ÙˆÙŠØ¨ Master', SpreadsheetApp.getUi().ButtonSet.OK);
    return;
  }
  
  const firstCell = masterSheet.getRange(1, 1).getValue();
  
  if (firstCell !== 'Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±' && firstCell !== 'SourceSheetName') {
    masterSheet.insertColumnBefore(1);
    masterSheet.getRange(1, 1).setValue('Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±');
    
    const headerRange = masterSheet.getRange(1, 1);
    headerRange.setFontWeight('bold');
    headerRange.setBackground('#4285f4');
    headerRange.setFontColor('#ffffff');
    
    log('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ "Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±" ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„');
    
    SpreadsheetApp.getUi().alert(
      'âœ… ØªÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯',
      'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ "Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±" ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„.\nÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« CONFIG.ID_COLUMN_INDEX Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±.',
      SpreadsheetApp.getUi().ButtonSet.OK
    );
  } else {
    SpreadsheetApp.getUi().alert('âœ… Ø¬Ø§Ù‡Ø²', 'Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„', SpreadsheetApp.getUi().ButtonSet.OK);
  }
}

/**
 * ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Sheet
 */
function loadSheetData(sheet) {
  const lastRow = sheet.getLastRow();
  const lastCol = sheet.getLastColumn();
  
  if (lastRow < CONFIG.START_ROW || lastCol === 0) {
    return {
      rows: [],
      startRow: CONFIG.START_ROW,
      lastRow: lastRow,
      lastCol: lastCol
    };
  }
  
  const numRows = lastRow - CONFIG.START_ROW + 1;
  const range = sheet.getRange(CONFIG.START_ROW, 1, numRows, lastCol);
  const values = range.getValues();
  
  return {
    rows: values,
    startRow: CONFIG.START_ROW,
    lastRow: lastRow,
    lastCol: lastCol
  };
}

/**
 * Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø±ÙŠØ·Ø© Master Ù…Ø­Ø³Ù‘Ù†Ø©
 */
function createMasterMap(rows, startRow) {
  const map = new Map();
  const idColIndex = CONFIG.ID_COLUMN_INDEX - 1;
  
  rows.forEach((row, index) => {
    // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
    if (isRowEmpty(row)) return;
    
    const id = String(row[idColIndex]).trim();
    
    if (id && id !== '') {
      map.set(id, {
        rowIndex: startRow + index,
        data: row,
        arrayIndex: index
      });
    }
  });
  
  return map;
}

/**
 * Ø¥Ù†Ø´Ø§Ø¡ IDs Ù„Ù„ØµÙÙˆÙ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
 */
function ensureIdsInSourceBatch(sheet, sourceData) {
  const idColIndex = CONFIG.ID_COLUMN_INDEX - 2;
  const rowsNeedingIds = [];
  
  sourceData.rows.forEach((row, index) => {
    // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
    if (isRowEmpty(row)) return;
    
    const id = String(row[idColIndex]).trim();
    
    if (!id || id === '') {
      rowsNeedingIds.push({
        rowIndex: sourceData.startRow + index,
        arrayIndex: index
      });
    }
  });
  
  if (rowsNeedingIds.length > 0) {
    log(`   ğŸ”‘ ÙŠÙˆØ¬Ø¯ ${rowsNeedingIds.length} ØµÙ Ø¨Ø­Ø§Ø¬Ø© Ù„Ù€IDs...`);
    
    const updates = [];
    rowsNeedingIds.forEach(item => {
      const newId = generateUniqueId();
      updates.push({
        range: sheet.getRange(item.rowIndex, CONFIG.ID_COLUMN_INDEX - 1),
        value: newId
      });
      
      sourceData.rows[item.arrayIndex][idColIndex] = newId;
    });
    
    // ÙƒØªØ§Ø¨Ø© Ø¬Ù…ÙŠØ¹ IDs Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
    updates.forEach(update => {
      update.range.setValue(update.value);
    });
    
    return rowsNeedingIds.length;
  }
  
  return 0;
}

/**
 * Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Master
 */
function syncDataToMaster(masterSheet, masterMap, activeSourceData) {
  const stats = { added: 0, updated: 0 };
  
  const rowsToAdd = [];
  const rowsToUpdate = [];
  
  // Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
  activeSourceData.forEach((sourceInfo, id) => {
    if (masterMap.has(id)) {
      // Ø§Ù„ØµÙ Ù…ÙˆØ¬ÙˆØ¯ - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
      const masterRow = masterMap.get(id);
      const updatedRow = sourceInfo.rowData;
      
      if (!areRowsEqual(masterRow.data, updatedRow)) {
        rowsToUpdate.push({
          rowIndex: masterRow.rowIndex,
          data: updatedRow,
          id: id
        });
        
        masterRow.data = updatedRow;
      }
    } else {
      // ØµÙ Ø¬Ø¯ÙŠØ¯
      rowsToAdd.push({
        data: sourceInfo.rowData,
        sourceOrder: sourceInfo.sourceOrder,
        id: id
      });
    }
  });
  
  // ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
  if (rowsToUpdate.length > 0) {
    log(`   âœï¸ ØªØ­Ø¯ÙŠØ« ${rowsToUpdate.length} ØµÙ...`);
    
    rowsToUpdate.forEach(update => {
      const range = masterSheet.getRange(update.rowIndex, 1, 1, update.data.length);
      range.setValues([update.data]);
    });
    
    stats.updated = rowsToUpdate.length;
  }
  
  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
  if (rowsToAdd.length > 0) {
    log(`   â• Ø¥Ø¶Ø§ÙØ© ${rowsToAdd.length} ØµÙ Ø¬Ø¯ÙŠØ¯...`);
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙÙˆÙ Ø­Ø³Ø¨ sourceOrder
    rowsToAdd.sort((a, b) => a.sourceOrder - b.sourceOrder);
    
    const dataToAdd = rowsToAdd.map(item => item.data);
    const lastRow = masterSheet.getLastRow();
    const startRow = lastRow + 1;
    
    const range = masterSheet.getRange(startRow, 1, dataToAdd.length, dataToAdd[0].length);
    range.setValues(dataToAdd);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    rowsToAdd.forEach((item, index) => {
      masterMap.set(item.id, {
        rowIndex: startRow + index,
        data: item.data,
        arrayIndex: masterMap.size + index
      });
    });
    
    stats.added = rowsToAdd.length;
  }
  
  return stats;
}

/**
 * Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙÙˆØ±ÙŠ Ù„Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±
 */
function deleteRemovedRows(sheet, masterMap, activeSourceData) {
  const rowsToDelete = [];
  
  // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Master Ù„ÙƒÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ø±
  masterMap.forEach((masterRow, id) => {
    if (!activeSourceData.has(id)) {
      rowsToDelete.push({
        id: id,
        rowIndex: masterRow.rowIndex
      });
    }
  });
  
  if (rowsToDelete.length === 0) {
    return 0;
  }
  
  log(`   ğŸ—‘ï¸ Ø­Ø°Ù ${rowsToDelete.length} ØµÙ Ù…Ø­Ø°ÙˆÙ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ø±...`);
  
  // Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„ØªØ¬Ù†Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ÙÙ‡Ø§Ø±Ø³
  rowsToDelete.sort((a, b) => b.rowIndex - a.rowIndex);
  
  rowsToDelete.forEach(item => {
    sheet.deleteRow(item.rowIndex);
    masterMap.delete(item.id);
    
    if (CONFIG.ENABLE_DETAILED_LOGS) {
      log(`   ğŸ—‘ï¸ Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ: ID=${item.id}`);
    }
  });
  
  return rowsToDelete.length;
}

/**
 * Ù…Ù‚Ø§Ø±Ù†Ø© ØµÙÙŠÙ†
 */
function areRowsEqual(row1, row2) {
  const minLength = Math.min(row1.length, row2.length);
  
  for (let i = 0; i < minLength; i++) {
    const val1 = normalizeValue(row1[i]);
    const val2 = normalizeValue(row2[i]);
    
    if (val1 !== val2) return false;
  }
  
  return true;
}

/**
 * ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
 */
function normalizeValue(value) {
  if (value === null || value === undefined) return '';
  if (value instanceof Date) return value.getTime();
  return String(value).trim();
}

/**
 * Ø¥Ù†Ø´Ø§Ø¡ ID ÙØ±ÙŠØ¯
 */
function generateUniqueId() {
  const timestamp = new Date().getTime();
  const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
  return `${CONFIG.ID_PREFIX}${timestamp}_${random}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø®Ø§Ù…Ø³: ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ IDs Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
 */
function regenerateAllIds() {
  const ui = SpreadsheetApp.getUi();
  const response = ui.alert(
    'âš ï¸ ØªØ­Ø°ÙŠØ±',
    'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ IDs Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ø±ØŸ\n\n' +
    'ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ IDs Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø£Ø®Ø±Ù‰ Ø¬Ø¯ÙŠØ¯Ø©.',
    ui.ButtonSet.YES_NO
  );
  
  if (response !== ui.Button.YES) return;
  
  let totalIds = 0;
  
  CONFIG.SOURCE_SHEET_IDS.forEach((sourceId, index) => {
    try {
      const sourceSheet = SpreadsheetApp.openById(sourceId).getSheetByName(CONFIG.SOURCE_SHEET_NAME);
      const data = loadSheetData(sourceSheet);
      const idsCreated = ensureIdsInSourceBatch(sourceSheet, data);
      totalIds += idsCreated;
    } catch (error) {
      log(`Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØµØ¯Ø± ${index + 1}: ${error.message}`);
    }
  });
  
  SpreadsheetApp.flush();
  ui.alert('âœ… ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${totalIds} ID Ø¬Ø¯ÙŠØ¯`, ui.ButtonSet.OK);
}

/**
 * Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
 */
function showSyncStatistics() {
  const masterSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(CONFIG.MASTER_SHEET_NAME);
  const masterData = loadSheetData(masterSheet);
  const masterMap = createMasterMap(masterData.rows, masterData.startRow);
  
  let totalSourceRows = 0;
  
  CONFIG.SOURCE_SHEET_IDS.forEach(sourceId => {
    try {
      const sourceSheet = SpreadsheetApp.openById(sourceId).getSheetByName(CONFIG.SOURCE_SHEET_NAME);
      const data = loadSheetData(sourceSheet);
      // Ø¹Ø¯ Ø§Ù„ØµÙÙˆÙ ØºÙŠØ± Ø§Ù„ÙØ§Ø±ØºØ© ÙÙ‚Ø·
      totalSourceRows += data.rows.filter(row => !isRowEmpty(row)).length;
    } catch (error) {
      // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    }
  });
  
  const message = 
    `ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…\n\n` +
    `ğŸ“‚ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø¯Ø±: ${CONFIG.SOURCE_SHEET_IDS.length}\n` +
    `ğŸ“‹ ØµÙÙˆÙ ÙÙŠ Master: ${masterData.rows.length}\n` +
    `ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹ ØµÙÙˆÙ Ø§Ù„Ù…ØµØ§Ø¯Ø± (ØºÙŠØ± ÙØ§Ø±ØºØ©): ${totalSourceRows}\n` +
    `â±ï¸ ÙØªØ±Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©: ÙƒÙ„ ${CONFIG.AUTO_SYNC_INTERVAL_HOURS} Ø³Ø§Ø¹Ø©\n\n` +
    `â„¹ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§\n` +
    `â„¹ï¸ Ø§Ù„Ø­Ø°Ù Ù…Ù† Master ÙŠØªÙ… ÙÙˆØ±Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±`;
  
  SpreadsheetApp.getUi().alert('ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', message, SpreadsheetApp.getUi().ButtonSet.OK);
}

/**
 * Ø¹Ø±Ø¶ Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
 */
function showUserGuide() {
  const guide = 
    `ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ø±ÙŠØ¹\n\n` +
    `1ï¸âƒ£ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠ:\n` +
    `   â€¢ Ø§Ø®ØªØ±: ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·)\n` +
    `   â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« CONFIG.SOURCE_SHEET_IDS\n\n` +
    `2ï¸âƒ£ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§:\n` +
    `   â€¢ Ø§Ø®ØªØ±: â–¶ï¸ ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±\n\n` +
    `3ï¸âƒ£ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©:\n` +
    `   â€¢ Ø§Ø®ØªØ±: âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª > âœ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©\n\n` +
    `4ï¸âƒ£ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙÙˆØ±ÙŠ:\n` +
    `   â€¢ ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙÙˆÙ Ù…Ù† Master ÙÙˆØ±Ù‹Ø§ Ø¹Ù†Ø¯ Ø­Ø°ÙÙ‡Ø§ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±\n` +
    `   â€¢ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØªØ±Ø© Ø³Ù…Ø§Ø­\n\n` +
    `5ï¸âƒ£ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©:\n` +
    `   â€¢ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙŠØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§\n` +
    `   â€¢ Ù‡Ø°Ø§ ÙŠØ­Ø³Ù† Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆÙŠÙˆÙØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø©\n\n` +
    `6ï¸âƒ£ Ø¹Ù…ÙˆØ¯ "Ø§Ø³Ù… Ø§Ù„Ù…ØµØ¯Ø±":\n` +
    `   â€¢ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ ØµÙ\n` +
    `   â€¢ ÙŠÙˆØ¶Ø­ Ù…Ù† Ø£ÙŠ Ù…Ù„Ù Ø¬Ø§Ø¡ Ø§Ù„ØµÙ\n\n` +
    `7ï¸âƒ£ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©:\n` +
    `   â€¢ Ø±Ø§Ø¬Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯\n` +
    `   â€¢ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª (Logs)`;
  
  SpreadsheetApp.getUi().alert('ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', guide, SpreadsheetApp.getUi().ButtonSet.OK);
}

/**
 * Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
 */
function showSyncCompletionMessage(stats, duration) {
  const ui = SpreadsheetApp.getUi();
  
  let message = 'âœ… Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!\n\n';
  message += `ğŸ“‚ Ø§Ù„Ù…ØµØ§Ø¯Ø±: ${stats.sourcesProcessed}/${CONFIG.SOURCE_SHEET_IDS.length}\n`;
  message += `â• Ù…Ø¶Ø§Ù: ${stats.rowsAdded}\n`;
  message += `âœï¸ Ù…Ø­Ø¯Ù‘Ø«: ${stats.rowsUpdated}\n`;
  
  if (stats.rowsDeleted > 0) {
    message += `ğŸ—‘ï¸ Ù…Ø­Ø°ÙˆÙ: ${stats.rowsDeleted}\n`;
  }
  
  if (stats.rowsSkipped > 0) {
    message += `â­ï¸ Ù…ØªØ¬Ø§Ù‡Ù„ (ÙØ§Ø±Øº): ${stats.rowsSkipped}\n`;
  }
  
  if (stats.idsGenerated > 0) {
    message += `ğŸ”‘ IDs Ø¬Ø¯ÙŠØ¯Ø©: ${stats.idsGenerated}\n`;
  }
  
  message += `â±ï¸ Ø§Ù„ÙˆÙ‚Øª: ${duration}Ø«`;
  
  if (stats.errors.length > 0) {
    message += `\n\nâš ï¸ ØªØ­Ø°ÙŠØ±: Ø­Ø¯Ø«Øª ${stats.errors.length} Ø£Ø®Ø·Ø§Ø¡`;
  }
  
  ui.alert('ğŸ”„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©', message, ui.ButtonSet.OK);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â° Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø³Ø§Ø¯Ø³: Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© (Triggers)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
 */
function enableAutoSync() {
  disableAutoSync();
  
  ScriptApp.newTrigger('syncAllSources')
    .timeBased()
    .everyHours(CONFIG.AUTO_SYNC_INTERVAL_HOURS)
    .create();
  
  log(`âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙƒÙ„ ${CONFIG.AUTO_SYNC_INTERVAL_HOURS} Ø³Ø§Ø¹Ø©`);
  
  SpreadsheetApp.getUi().alert(
    'âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„',
    `ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©.\nØ³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙƒÙ„ ${CONFIG.AUTO_SYNC_INTERVAL_HOURS} Ø³Ø§Ø¹Ø©.`,
    SpreadsheetApp.getUi().ButtonSet.OK
  );
}

/**
 * Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
 */
function disableAutoSync() {
  const triggers = ScriptApp.getProjectTriggers();
  let deletedCount = 0;
  
  triggers.forEach(trigger => {
    if (trigger.getHandlerFunction() === 'syncAllSources') {
      ScriptApp.deleteTrigger(trigger);
      deletedCount++;
    }
  });
  
  log(`âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} trigger`);
  
  if (deletedCount > 0) {
    SpreadsheetApp.getUi().alert(
      'âœ… ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù',
      'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©.',
      SpreadsheetApp.getUi().ButtonSet.OK
    );
  }
}

/**
 * Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
 */
function showTriggerStatus() {
  const triggers = ScriptApp.getProjectTriggers();
  const syncTriggers = triggers.filter(t => t.getHandlerFunction() === 'syncAllSources');
  
  let message;
  
  if (syncTriggers.length === 0) {
    message = 'âŒ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ØºÙŠØ± Ù…ÙØ¹Ù„Ø©\n\nÙ„ØªÙØ¹ÙŠÙ„Ù‡Ø§ØŒ Ø§Ø®ØªØ±:\nâš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ > âœ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©';
  } else {
    message = `âœ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…ÙØ¹Ù„Ø©\n\n`;
    message += `ğŸ”„ Ø§Ù„ØªÙƒØ±Ø§Ø±: ÙƒÙ„ ${CONFIG.AUTO_SYNC_INTERVAL_HOURS} Ø³Ø§Ø¹Ø©\n`;
    message += `ğŸ“Š Ø¹Ø¯Ø¯ Triggers: ${syncTriggers.length}`;
  }
  
  SpreadsheetApp.getUi().alert('â° Ø­Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', message, SpreadsheetApp.getUi().ButtonSet.OK);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø³Ø§Ø¨Ø¹: ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª (Logging)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/**
 * ØªØ³Ø¬ÙŠÙ„ Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
 */
function log(message) {
  if (CONFIG.ENABLE_DETAILED_LOGS) {
    console.log(message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“š Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø© ÙˆØ¯Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

//
// ğŸš€ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1ï¸âƒ£ Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ Apps Script
// 2ï¸âƒ£ Ø¹Ø¯Ù‘Ù„ CONFIG.SOURCE_SHEET_IDS
// 3ï¸âƒ£ Ø´ØºÙ‘Ù„ testSetup() Ù„Ù…Ù†Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
// 4ï¸âƒ£ Ø£ØºÙ„Ù‚ ÙˆØ£Ø¹Ø¯ ÙØªØ­ Ø§Ù„Ù…Ù„Ù
// 5ï¸âƒ£ Ø§Ø®ØªØ±: ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
// 6ï¸âƒ£ Ø§Ø®ØªØ±: â–¶ï¸ ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
